package net.rezmason.engram.games.busybodhi {		// IMPORT STATEMENTS	import flash.events.Event;	import flash.events.TimerEvent;	import flash.utils.getTimer;	import flash.utils.Timer;		import net.rezmason.engram.modules.Game;	import net.rezmason.engram.modules.GameModule;	import net.rezmason.engram.modules.GameType;	import net.rezmason.engram.modules.ModuleKeyRoles;	import net.rezmason.engram.modules.ModuleView;	import net.rezmason.media.SoundManager;			public final class BusyBodhi extends GameModule {				// CLASS PROPERTIES				// INSTANCE PROPERTIES		private var _bbGame:BBGame = new BBGame;		private var _bbView:BBView = new BBView(_bbGame);		private var _bbSettingsView:BBSettingsView = new BBSettingsView(_bbGame);				private var _alive:Boolean = false;		private var soundManager:SoundManager = SoundManager.INSTANCE;		private var gameTimer:Timer = new Timer(1000);		private var windowTimer:Timer = new Timer(1000, 1);		private var window:int = 500;		private var lastTime:int;		private var shortTypeMap:Object;				public function BusyBodhi():void {						shortTypeMap = {				(ModuleKeyRoles.AKEY as String):0,				(ModuleKeyRoles.BKEY as String):1,				(ModuleKeyRoles.XKEY as String):2,				(ModuleKeyRoles.YKEY as String):3			}						_defaultSettings["Example"] = true;						_game = _bbGame as Game;			_view = _bbView as ModuleView;			_settingsView = _bbSettingsView as ModuleView;						addColorChild(_view);						_title = "BusyBodhi";			_version = "1.0";			_author = "Rezmason";						_sounds.highFlickSound = new HighFlickSound, _channels.highFlickSound = 1;			_sounds.flickSound = new FlickSound, _channels.flickSound = 1;						_icon = new GameIcon;						loaderInfo.addEventListener(Event.INIT, initComplex, false, 0, true);						windowTimer.addEventListener(TimerEvent.TIMER_COMPLETE, cancelSlowCombo);					}				// GETTERS & SETTERS				override public function get score():int {			return super.score;		}				// PUBLIC METHODS				override public function unlock():void {			super.unlock();		}				override public function reset(event:Event = null):void {			super.reset();			windowTimer.reset();			_alive = false;		}				override public function resize(ratio:Number = 1, updateView:Boolean = false):void {			_bbView.resize(ratio);			if (updateView) {							}		}				override public function start(event:Event = null, gameType:String = null, debug:Boolean = false):void {						super.start();						interpretSettings();						if (debug) {				_bbGame.debug();			}						_alive = true;			beginNewRound();						switch (_gameType) {				default :				case GameType.ARCADE :					trace("BB: ARCADE!");				break;				case GameType.STUDIO :					trace("BB: STUDIO!");				break;				case GameType.DRILL :					trace("BB: DRILL!");				break;			}		}				override public function pause(event:Event = null):void {			super.pause();			_bbGame.cancelCombo();			_bbView.clearComboGlyphs();			windowTimer.reset();		}				override public function resume(event:Event = null):void {			super.resume();			if (!_alive) {				_alive = true;				beginNewRound();			} else {							}		}				override public function end(event:Event = null):void {			super.end();			_bbGame.cancelCombo();			_bbView.clearComboGlyphs();		}				// PRIVATE & PROTECTED METHODS				override protected function interpretSettings():void {			if (_settings["Example"] != undefined) {							}		}				override protected function handleKeyDown(inputType:String):void {			var time:int = getTimer();						windowTimer.reset();						var shortType:int = getShortType(inputType);			if (shortType != -1) {				var beat:Beat = makeBeat();				beat.key = shortType;				beat.time = time - lastTime;				if (beat.time > 40) {					_bbGame.push(beat);					} else {					_bbGame.cancelCombo();					_bbView.clearComboGlyphs();				}								var matches:Array = _bbGame.findMatches(0);				if (matches.length == 1) {					_bbView.clearComboGlyphs(true);				} else if (matches.length) {					windowTimer.start();				} else {					_bbGame.cancelCombo();					_bbView.clearComboGlyphs();				}								lastTime = time;			}		}				private function cancelSlowCombo(event:Event):void {			_bbGame.cancelCombo();			_bbView.clearComboGlyphs();		}				private function initComplex(event:Event):void {			if (free) {				stage.focus = stage;								stage.addEventListener("keyDown", function(e:*):void { 					var val:String					switch (e.keyCode) {						case 90: val = ModuleKeyRoles.AKEY; break;						case 88: val = ModuleKeyRoles.BKEY; break;						case 65: val = ModuleKeyRoles.XKEY; break;						case 83: val = ModuleKeyRoles.YKEY; break;						default: _bbGame.debug(); break;					}					handleKeyDown(val); 				});								x = stage.stageWidth / 2;				y = stage.stageHeight / 2;				unlock();				reset();				start();			}		}				private function beginNewRound():void {					}				private function makeBeat():Beat {			return new Beat();	// this can be smarter eventually		}				private function getShortType(inputType:String):int {			return shortTypeMap[inputType] == undefined ? -1 : shortTypeMap[inputType];		}	}}